<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Portal Fornecedor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/colorjs.io/dist/color.global.js"></script>
    <link rel="stylesheet" href="/style/dashboard.css" />
</head>

<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <nav class="col-md-2 d-none d-md-block sidebar">
                <div class="position-sticky">
                    <div class="text-center py-3">
                        <img src="https://www.allflags.com.br/wp-content/uploads/2017/09/logo_nxboats.png"
                            class="img-fluid" alt="Logo" />
                        <h6 class="mt-5">Menu</h6>
                    </div>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a href="/pages/dashboard.html" class="nav-link"><i class="fas fa-tv me-2"></i>Painel</a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link"><i class="fas fa-truck me-2"></i>Pedidos</a>
                        </li>
                        <li class="nav-item">
                            <a href="/pages/produtos.html" class="nav-link"><i class="fas fa-cube me-2"></i>Produtos</a>
                        </li>
                        <li class="nav-item">
                            <a href="/pages/finaceiro.html" class="nav-link"><i
                                    class="fas fa-sack-dollar me-2"></i>Financeiro</a>
                        </li>
                        <li class="nav-item mt-5 m-3"><strong>Informações</strong></li>
                        <li class="nav-item">
                            <a href="#" class="nav-link active"><i class="fas fa-user me-2"></i>Conta</a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" id="logoutBtnSidebar"><i
                                    class="fas fa-sign-in-alt me-2"></i>Sair</a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- Main -->
            <main class="col-md-10 ms-sm-auto col-lg-10 px-md-4">
                <div class="container mt-5">
                    <div class="row justify-content-center">
                        <div class="col-lg-12">
                            <div class="card shadow">
                                <div class="card-header bg-secondary text-white text-center">
                                    <h5 class="mb-0 text-white">Dados do Fornecedor</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row mb-2">
                                        <div class="col-md-6"><strong>Nome:</strong> <span id="nomeParc">...</span>
                                        </div>
                                        <div class="col-md-6"><strong>Tipo de Pessoa:</strong> <span
                                                id="tipoPessoa">...</span></div>
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-md-6"><strong>Razão Social:</strong> <span
                                                id="razaoSocial">...</span></div>
                                        <div class="col-md-6"><strong>Telefone:</strong> <span id="telefone">...</span>
                                        </div>
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-md-6"><strong>CNPJ/CPF:</strong> <span id="documento">...</span>
                                        </div>
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-12"><strong>Endereço:</strong> <span id="endereco">...</span>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6"><strong>CEP:</strong> <span id="cep">...</span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!--Table Contatos-->
                <div class="container mt-5">
                    <div class="row mt-5 justify-content-center">
                        <div class="col-12">
                            <div class="card shadow-sm">
                                <div class="card-header bg-secondary d-flex justify-content-between align-items-center">
                                    <h5 class="mb-0 text-white">Contatos</h5>
                                </div>
                                <div class="card-body table-responsive">
                                    <table class="table align-middle">
                                        <thead class="table-light">
                                            <tr>
                                                <th scope="col">Contato</th>
                                                <th scope="col">Email</th>
                                                <th scope="col">Número</th>
                                                <th scope="col" class="text-center">Editar</th>
                                                <th scope="col" class="text-center">Excluir</th>
                                            </tr>
                                        </thead>
                                        <tbody id="tabela-produtos"></tbody>
                                    </table>
                                    <button class="btn btn-primary tec" id="btnAddContato">
                                        <i class="fas fa-plus me-1"></i>Adicionar Contato
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", async () => {
            const usuario = sessionStorage.getItem("usuario");
            const senha = sessionStorage.getItem("senha");
            const codparc = sessionStorage.getItem("codparc");

            if (!usuario || !senha || !codparc) {
                alert("Sessão expirada. Faça login novamente.");
                window.location.href = "/pages/login.html";
                return;
            }

            try {
                const response = await fetch("http://localhost:3000/api/conta", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ usuario, senha, codparc })
                });

                const dados = await response.json();

                if (dados.erro) {
                    alert(dados.erro);
                    return;
                }

                document.getElementById("nomeParc").textContent = dados.NOMEPARC || "-";
                document.getElementById("tipoPessoa").textContent = dados.TIPPESSOA === "F" ? "Física" : "Jurídica";
                document.getElementById("razaoSocial").textContent = dados.RAZAOSOCIAL || "-";
                document.getElementById("telefone").textContent = dados.TELEFONE || "-";
                document.getElementById("documento").textContent = dados.CGC_CPF || "-";

                const endereco = [dados.NOMEEND, dados.NOMEBAI, dados.NOMECID, dados.UF]
                    .filter(i => i && i !== "null")
                    .join(", ");
                document.getElementById("endereco").textContent = endereco || "-";

                const cepFormatado = dados.CEP?.replace(/^(\d{5})(\d{3})$/, "$1-$2") || "-";
                document.getElementById("cep").textContent = cepFormatado;

            } catch (err) {
                console.error("Erro ao carregar dados:", err);
                alert("Erro ao carregar dados da conta.");
            }
        });

        async function carregarContatos() {
            const usuario = sessionStorage.getItem("usuario");
            const senha = sessionStorage.getItem("senha");
            const codparc = sessionStorage.getItem("codparc");

            try {
                const response = await fetch("http://localhost:3000/api/contatos", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ usuario, senha, codparc })
                });

                const contatos = await response.json();

                const tabela = document.getElementById("tabela-produtos");
                tabela.innerHTML = "";

                if (!contatos.length) {
                    tabela.innerHTML = `<tr><td colspan="5" class="text-center text-muted">Nenhum contato encontrado.</td></tr>`;
                    return;
                }

                contatos.forEach(contato => {
                    const row = document.createElement("tr");

                    row.innerHTML = `
          <td>${contato.nome}</td>
          <td>${contato.email}</td>
          <td>${contato.telefone}</td>
          <td class="text-center"><button class="btn btn-sm btn-outline-primary" disabled><i class="fas fa-edit"></i></button></td>
          <td class="text-center"><button class="btn btn-sm btn-outline-danger" disabled><i class="fas fa-trash-alt"></i></button></td>
        `;

                    tabela.appendChild(row);
                });

            } catch (err) {
                console.error("Erro ao carregar contatos:", err);
                alert("Erro ao carregar contatos.");
            }
        }

        // Chamar ao carregar a página
        document.addEventListener("DOMContentLoaded", carregarContatos);

        document.getElementById("logoutBtnSidebar")?.addEventListener("click", () => {
            sessionStorage.clear();
            window.location.href = "/pages/login.html";
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>